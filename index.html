<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Plant Doctor AI</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {font-family:system-ui,-apple-system,sans-serif;background:#f8fafc;color:#1e293b;}
    .card {background:white;box-shadow:0 10px 25px rgba(0,0,0,.08);border-radius:1.25rem;transition:transform .3s,box-shadow .3s;}
    .card:hover {transform:translateY(-2px);box-shadow:0 15px 35px rgba(0,0,0,.12);}
    #upload-box {border:3px solid #86efac;background:rgba(134,239,172,.15);transition:all .3s ease;cursor:pointer;border-radius:1rem;}
    #upload-box:hover {background:rgba(74,222,128,.25);border-color:#22c55e;transform:scale(1.02);}
    .focus-ring {box-shadow:0 0 0 4px rgba(34,197,94,.3);}
    .loader {border:4px solid #e2e8f0;border-top:4px solid #10b981;border-radius:50%;width:24px;height:24px;animation:spin 1s linear infinite;display:inline-block;margin-right:.5rem;}
    @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
    #camera-modal {background:rgba(0,0,0,.75);z-index:50;}
    #video {width:100%;max-width:640px;border-radius:1rem;}
    .header-title {font-weight:800;font-size:1.8rem;letter-spacing:-.5px;background:linear-gradient(90deg,#16a34a,#15803d);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
    @media (max-width:640px){.header-title{font-size:1.5rem}}
  </style>
</head>
<body class="min-h-screen flex flex-col">

<!-- Header -->
<header class="bg-white shadow-sm border-b border-gray-100 fixed top-0 left-0 right-0 z-40">
  <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-center">
    <h1 class="header-title">Plant Doctor AI</h1>
  </div>
</header>

<main class="flex-1 pt-20 pb-8 px-4 max-w-7xl mx-auto w-full">

  <!-- Auth Section -->
  <div id="auth-section" class="bg-white rounded-xl card p-6 md:p-10 mt-6">
    <div id="login-form-container">
      <header class="text-center mb-10">
        <h2 class="text-3xl font-bold text-gray-800 mb-3">Welcome Back</h2>
        <p class="text-gray-600">Login to access the plant health checker.</p>
      </header>
      <form id="login-form" class="space-y-6">
        <div>
          <label for="login-username" class="block text-gray-700 font-medium mb-2">Username</label>
          <input type="text" id="login-username" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 bg-gray-50" required>
        </div>
        <div>
          <label for="login-password" class="block text-gray-700 font-medium mb-2">Password</label>
          <input type="password" id="login-password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 bg-gray-50" required>
        </div>
        <button type="submit" class="w-full bg-gradient-to-r from-green-600 to-green-700 text-white py-3 rounded-lg font-bold hover:from-green-700 hover:to-green-800 transition focus:ring-4 focus:ring-green-300">Login</button>
      </form>
      <p class="text-center mt-6 text-gray-600">Don't have an account? <a href="#" id="switch-to-signup" class="text-green-600 font-medium hover:underline">Sign up</a></p>
      <p id="login-error" class="text-red-600 mt-6 text-center hidden text-sm">Invalid username or password.</p>
    </div>

    <div id="signup-form-container" class="hidden">
      <header class="text-center mb-10">
        <h2 class="text-3xl font-bold text-gray-800 mb-3">Create Account</h2>
        <p class="text-gray-600">Join Plant Doctor AI today.</p>
      </header>
      <form id="signup-form" class="space-y-6">
        <div>
          <label for="signup-username" class="block text-gray-700 font-medium mb-2">Username</label>
          <input type="text" id="signup-username" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 bg-gray-50" required>
        </div>
        <div>
          <label for="signup-password" class="block text-gray-700 font-medium mb-2">Password</label>
          <input type="password" id="signup-password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 bg-gray-50" required>
        </div>
        <button type="submit" class="w-full bg-gradient-to-r from-green-600 to-green-700 text-white py-3 rounded-lg font-bold hover:from-green-700 hover:to-green-800 transition focus:ring-4 focus:ring-green-300">Sign Up</button>
      </form>
      <p class="text-center mt-6 text-gray-600">Already have an account? <a href="#" id="switch-to-login" class="text-green-600 font-medium hover:underline">Login</a></p>
      <p id="signup-error" class="text-red-600 mt-6 text-center hidden text-sm">Username already exists.</p>
      <p id="signup-success" class="text-green-600 mt-6 text-center hidden text-sm">Account created! Please login.</p>
    </div>
  </div>

  <!-- Main App -->
  <div id="main-section" class="hidden bg-white rounded-xl card p-6 md:p-10 mt-6">
    <div class="flex justify-end mb-6 gap-3">
      <button id="lang-toggle" class="bg-indigo-600 text-white py-2 px-5 rounded-lg font-medium hover:bg-indigo-700">ಕನ್ನಡ</button>
      <button id="logout-button" class="bg-red-600 text-white py-2 px-5 rounded-lg font-medium hover:bg-red-700">Logout</button>
    </div>

    <p class="text-lg text-gray-600 text-center mb-10 max-w-2xl mx-auto">Upload a leaf image to get an instant diagnosis and treatment plan.</p>

    <div id="upload-section">
      <div id="upload-box" onclick="triggerFileUpload()" class="flex flex-col items-center justify-center h-56 rounded-xl p-8 text-gray-700 mb-6">
        <svg class="w-16 h-16 mb-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 014 4v2m-5-8l-2-2m0 0L7 8m2-2v4"></path></svg>
        <p class="font-semibold text-xl">Click or Drag & Drop your Plant Leaf Image</p>
        <p class="text-sm text-gray-500 mt-2">JPEG, PNG, or GIF up to 4 MB</p>
      </div>
      <button id="use-camera" class="w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700">Take Photo from Camera</button>
      <input type="file" id="file-upload" accept="image/*" class="hidden" onchange="handleFileChange(event)">
    </div>

    <div id="preview-section" class="hidden mt-10 p-6 border border-gray-300 rounded-xl bg-gray-50">
      <h2 class="text-xl font-semibold text-green-700 mb-6">Diagnosis Status</h2>
      <div class="md:flex md:space-x-8">
        <div class="mb-6 md:mb-0 md:w-1/3">
          <p class="text-gray-600 mb-3 font-medium">Uploaded Image:</p>
          <img id="image-preview" class="w-full h-auto object-cover rounded-lg shadow-md border border-gray-200" alt="Preview">
        </div>
        <div class="md:w-2/3 flex flex-col justify-between space-y-4">
          <div id="status-message" class="text-gray-700 text-base p-4 rounded-lg bg-yellow-50 border-l-4 border-yellow-400">Please upload an image.</div>
          <button id="diagnose-button" onclick="startDiagnosis()" class="w-full bg-gradient-to-r from-green-600 to-green-700 text-white py-3 rounded-lg font-bold hover:from-green-700 hover:to-green-800" disabled>Start AI Diagnosis (Needs Internet)</button>
          <button id="reset-button" onclick="resetApp()" class="w-full bg-gray-200 text-gray-800 py-3 rounded-lg font-bold hover:bg-gray-300">Reset</button>
        </div>
      </div>
    </div>

    <div id="result-section" class="hidden mt-12">
      <h2 class="text-3xl font-bold text-red-600 mb-8 border-b border-gray-300 pb-3"><span id="diagnosis-emoji">Warning</span> Diagnosis Result</h2>
      <div class="grid md:grid-cols-2 gap-8">
        <div class="bg-red-50 p-8 rounded-xl border border-red-200">
          <h3 class="text-xl font-semibold text-red-700 mb-4">Identified Issue:</h3>
          <p id="result-diagnosis" class="text-2xl font-extrabold text-red-800"></p>
          <p id="result-plant-type" class="text-gray-600 mt-2"></p>
        </div>
        <div class="bg-green-50 p-8 rounded-xl border border-green-200">
          <h3 class="text-xl font-semibold text-green-700 mb-4">AI Confidence:</h3>
          <p id="result-confidence" class="text-2xl font-extrabold text-green-800"></p>
        </div>
      </div>
      <div class="mt-8 bg-gradient-to-br from-gray-50 to-gray-100 p-8 rounded-xl border border-gray-300 shadow-inner">
        <h3 class="text-2xl font-bold text-green-800 mb-5 flex items-center">
          <svg class="w-7 h-7 mr-3 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.204A9.954 9.954 0 0012 3c-4.419 0-8.24 1.803-10.618 4.796m14.236 0c.2.469.366.97.485 1.504M20 10.5c0 .324.015.645.044.966M12 21c-2.41 0-4.63-.642-6.556-1.754M17.152 14.848l-1.424-1.424m-1.424-1.424l-1.424-1.424"></path></svg>
          Recommended Treatment Plan
        </h3>
        <p id="result-treatment" class="text-gray-700 whitespace-pre-wrap leading-relaxed"></p>
      </div>
    </div>
  </div>
</main>

<!-- Camera Modal -->
<div id="camera-modal" class="hidden fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-75 p-4">
  <div class="bg-white p-6 rounded-xl shadow-2xl max-w-lg w-full">
    <video id="video" autoplay playsinline class="w-full rounded-lg"></video>
    <div class="mt-6 flex justify-between gap-3">
      <button id="capture-button" class="flex-1 bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700">Capture</button>
      <button id="close-camera" class="flex-1 bg-gray-600 text-white py-3 rounded-lg font-bold hover:bg-gray-700">Close</button>
    </div>
  </div>
</div>

<script>
/* ---------- CONFIG ---------- */
const apiKey = "YOUR_API_KEY_HERE"; // Replace with your Gemini API key
const API_URL = https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey};

/* ---------- AI DIAGNOSIS ---------- */
async function startDiagnosis() {
  if (!uploadedFileBase64) return;

  const mimeType = uploadInput.files[0]?.type || "image/jpeg";
  const systemPrompt = `You are a world-class plant pathologist. Analyze the leaf image and return ONLY a JSON object with:
  plantType (string), diseaseName (string or "Healthy"), confidenceScore (number 0-1), treatmentPlan (string with 3-5 steps).`;

  const payload = {
    contents: [
      {
        role: "user",
        parts: [
          { text: "Analyze this plant leaf." },
          { inlineData: { mimeType, data: uploadedFileBase64 } }
        ]
      }
    ],
    system_instruction: { parts: [{ text: systemPrompt }] },
    generation_config: {
      response_mime_type: "application/json",
      response_schema: {
        type: "OBJECT",
        properties: {
          plantType: { type: "STRING" },
          diseaseName: { type: "STRING" },
          confidenceScore: { type: "NUMBER", minimum: 0, maximum: 1 },
          treatmentPlan: { type: "STRING" }
        },
        required: ["plantType", "diseaseName", "confidenceScore", "treatmentPlan"]
      }
    },
    safety_settings: [
      { category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_NONE" },
      { category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_NONE" },
      { category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_NONE" },
      { category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_NONE" }
    ]
  };

  try {
    const r = await fetch(API_URL, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(payload) });
    if (!r.ok) throw new Error(HTTP ${r.status}: ${await r.text()});
    const j = await r.json();
    const txt = j.candidates?.[0]?.content?.parts?.[0]?.text;
    if (!txt) throw new Error("No AI response");
    const data = JSON.parse(txt);
    displayResults(data);
  } catch (err) {
    alert("Error: " + err.message);
  }
}
</script>
</body>
</html>
